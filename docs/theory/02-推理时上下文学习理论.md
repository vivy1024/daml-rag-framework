# æ¨ç†æ—¶ä¸Šä¸‹æ–‡å­¦ä¹ ç†è®º

**ç‰ˆæœ¬**: 1.0.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-11-05  
**çŠ¶æ€**: ğŸ“ æ ¸å¿ƒç†è®º

[English Version](./02-In-Context-Learning.md)

---

## æ‘˜è¦

æœ¬æ–‡æ¡£ä»‹ç»ç‰çå¥èº«æ¡†æ¶ä¸­**æ¨ç†æ—¶ä¸Šä¸‹æ–‡å­¦ä¹ ï¼ˆIn-Context Learning, ICLï¼‰**çš„ç†è®ºåŸºç¡€,çº æ­£äº†ä¹‹å‰"æ¨ç†æ—¶å…ƒå­¦ä¹ "çš„é”™è¯¯å‘½åã€‚æ ¸å¿ƒæœºåˆ¶ç»“åˆFew-Shotå­¦ä¹ ã€ä¸Šä¸‹æ–‡æ³¨å…¥å’Œæ¡ˆä¾‹æ¨ç†,ä½¿å°æ¨¡å‹åœ¨æ— éœ€é¢å¤–è®­ç»ƒçš„æƒ…å†µä¸‹,åœ¨å‚ç›´é¢†åŸŸè·å¾—ä¸“å®¶çº§è¡¨ç°ã€‚

**âš ï¸ æœ¯è¯­ä¿®æ­£ï¼ˆv2.0ï¼‰**ï¼š
- âŒ **v1.0é”™è¯¯**: "æ¨ç†æ—¶å…ƒå­¦ä¹ "ï¼ˆè¯¯å¯¼æ€§æœ¯è¯­ï¼‰
- âœ… **v2.0ä¿®æ­£**: "æ¨ç†æ—¶ä¸Šä¸‹æ–‡å­¦ä¹ "ï¼ˆå‡†ç¡®æœ¯è¯­ï¼‰

---

## 1. æœ¯è¯­ä¿®æ­£

### 1.1 ä»€ä¹ˆæ˜¯å…ƒå­¦ä¹ ï¼ˆMeta-Learningï¼‰ï¼Ÿ

**çœŸæ­£çš„å…ƒå­¦ä¹ **ï¼ˆå­¦ä¼šå­¦ä¹ ï¼‰[1]ï¼š
```
æ¦‚å¿µï¼šè®­ç»ƒæ¨¡å‹å­¦ä¹ "å¦‚ä½•å­¦ä¹ "

æµç¨‹ï¼š
    1. é¢„è®­ç»ƒé˜¶æ®µï¼š
       - åœ¨å¤šä¸ªä»»åŠ¡ä¸Šè®­ç»ƒ
       - å­¦ä¹ ä»»åŠ¡é€‚é…ç­–ç•¥
       - æ›´æ–°æ¨¡å‹å‚æ•°
    
    2. å…ƒæµ‹è¯•é˜¶æ®µï¼š
       - å°†å­¦åˆ°çš„ç­–ç•¥åº”ç”¨åˆ°æ–°ä»»åŠ¡
       - ç”¨å°‘é‡æ ·æœ¬å¿«é€Ÿé€‚é…
    
ç‰¹å¾ï¼š
    âœ… éœ€è¦è®­ç»ƒ/å¾®è°ƒ
    âœ… åœ¨è®­ç»ƒæ—¶è·¨ä»»åŠ¡å­¦ä¹ 
    âœ… æ›´æ–°æ¨¡å‹æƒé‡
    
ç¤ºä¾‹ï¼š
    - MAML (æ¨¡å‹æ— å…³å…ƒå­¦ä¹ )
    - Prototypical Networksï¼ˆåŸå‹ç½‘ç»œï¼‰
    - Matching Networksï¼ˆåŒ¹é…ç½‘ç»œï¼‰
```

### 1.2 ä»€ä¹ˆæ˜¯ä¸Šä¸‹æ–‡å­¦ä¹ ï¼ˆIn-Context Learningï¼‰ï¼Ÿ

**ä¸Šä¸‹æ–‡å­¦ä¹ ï¼ˆICLï¼‰** [2]ï¼š
```
æ¦‚å¿µï¼šåœ¨æ¨ç†æ—¶é€šè¿‡ä¸Šä¸‹æ–‡ä¸­çš„ç¤ºä¾‹å­¦ä¹ 

æµç¨‹ï¼š
    1. æ— è®­ç»ƒé˜¶æ®µ
    2. æ¨ç†æ—¶ï¼š
       - åœ¨æç¤ºè¯ä¸­æä¾›ä»»åŠ¡ç¤ºä¾‹
       - æ¨¡å‹ä»ä¸Šä¸‹æ–‡æ¨æ–­ä»»åŠ¡
       - ç”Ÿæˆå›ç­”
    
ç‰¹å¾ï¼š
    âœ… æ— éœ€è®­ç»ƒ/å¾®è°ƒ
    âœ… ç¤ºä¾‹ä»…åœ¨ä¸Šä¸‹æ–‡ä¸­
    âœ… ä¸æ›´æ–°æƒé‡
    
ç¤ºä¾‹ï¼š
    - GPT-3 Few-Shot Learning
    - Chain-of-Thought Promptingï¼ˆæ€ç»´é“¾æç¤ºï¼‰
    - Case-Based Reasoningï¼ˆæ¡ˆä¾‹æ¨ç†ï¼‰
```

### 1.3 ä¸ºä»€ä¹ˆè¦ä¿®æ­£ï¼Ÿ

**v1.0é”™è¯¯åˆ†æ**ï¼š
```
æˆ‘ä»¬ä¹‹å‰é”™è¯¯åœ°ç§°ä¹‹ä¸º"æ¨ç†æ—¶å…ƒå­¦ä¹ "ï¼Œå› ä¸ºï¼š
    âŒ åœ¨æ¨ç†æ—¶ä½¿ç”¨ç¤ºä¾‹ â†’ çœ‹èµ·æ¥åƒ"å­¦ä¹ "
    âŒ é€‚é…åˆ°é¢†åŸŸ â†’ çœ‹èµ·æ¥åƒ"å…ƒå­¦ä¹ "
    âŒ æå‡äº†æ€§èƒ½ â†’ çœ‹èµ·æ¥åƒ"è®­ç»ƒ"

ä½†å®é™…ä¸Šï¼š
    âœ… æ²¡æœ‰æ›´æ–°æ¨¡å‹æƒé‡ â†’ ä¸æ˜¯MLæ„ä¹‰ä¸Šçš„"å­¦ä¹ "
    âœ… æ²¡æœ‰è·¨ä»»åŠ¡è®­ç»ƒ â†’ ä¸æ˜¯"å…ƒå­¦ä¹ "
    âœ… åªæ˜¯æ“ä½œä¸Šä¸‹æ–‡ â†’ æ˜¯"ä¸Šä¸‹æ–‡å­¦ä¹ "
```

**æ­£ç¡®åç§°**ï¼š
- **ä¸Šä¸‹æ–‡å­¦ä¹ ï¼ˆIn-Context Learningï¼‰** + **æ¡ˆä¾‹æ¨ç†ï¼ˆCase-Based Reasoningï¼‰** [3]
- åˆ©ç”¨LLMå›ºæœ‰çš„ICLèƒ½åŠ› [2]
- é€šè¿‡é¢†åŸŸçŸ¥è¯†æ£€ç´¢å¢å¼º

---

## 2. æ ¸å¿ƒæœºåˆ¶

### 2.1 ä¼ ç»Ÿä¸Šä¸‹æ–‡å­¦ä¹ ï¼ˆGPT-3é£æ ¼ï¼‰

**åŸç‰ˆICL**ï¼š
```python
# ä¼ ç»ŸFew-Shotæç¤º
prompt = """
åˆ†ç±»ä»¥ä¸‹è¯„è®ºçš„æƒ…æ„Ÿï¼š

ç¤ºä¾‹1:
è¯„è®ºï¼š"è¿™ä¸ªäº§å“å¤ªæ£’äº†ï¼"
æƒ…æ„Ÿï¼šæ­£é¢

ç¤ºä¾‹2:
è¯„è®ºï¼š"è´¨é‡å¤ªå·®,æµªè´¹é’±ã€‚"
æƒ…æ„Ÿï¼šè´Ÿé¢

ç¤ºä¾‹3:
è¯„è®ºï¼š"è¿˜è¡Œ,æ²¡ä»€ä¹ˆç‰¹åˆ«çš„ã€‚"
æƒ…æ„Ÿï¼šä¸­æ€§

ç°åœ¨åˆ†ç±»:
è¯„è®ºï¼š"{user_input}"
æƒ…æ„Ÿï¼š
"""
```

**å±€é™æ€§**ï¼š
```
âŒ é€šç”¨ç¤ºä¾‹ï¼ˆéé¢†åŸŸç‰¹å®šï¼‰
âŒ é™æ€ç¤ºä¾‹ï¼ˆä¸æŸ¥è¯¢æ— å…³ï¼‰
âŒ æœ‰é™ç¤ºä¾‹ï¼ˆTokené™åˆ¶ï¼‰
âŒ æ— éªŒè¯ï¼ˆè´¨é‡æ— ä¿éšœï¼‰
```

### 2.2 ç‰çå¥èº«ä¸­çš„å¢å¼ºICL

**GraphRAGå¢å¼ºICL**ï¼š
```python
def enhanced_icl(user_query: str, user_context: Dict):
    """
    GraphRAGå¢å¼ºçš„ä¸Šä¸‹æ–‡å­¦ä¹ 
    """
    
    # æ­¥éª¤1: é€šè¿‡GraphRAGæ£€ç´¢ç›¸å…³ç¤ºä¾‹
    examples = graphrag_retrieve(
        query=user_query,
        filters={
            "domain": user_context["domain"],
            "user_level": user_context["level"],
            "quality_score": ">4.0"  # åªè¦é«˜è´¨é‡ç¤ºä¾‹
        },
        limit=3  # Tokené«˜æ•ˆ
    )
    
    # æ­¥éª¤2: æ„å»ºåŒ…å«æ£€ç´¢ç¤ºä¾‹çš„ä¸Šä¸‹æ–‡
    context = build_context(
        examples=examples,
        domain_guidelines=get_guidelines(user_context["domain"]),
        user_preferences=user_context["preferences"]
    )
    
    # æ­¥éª¤3: ç”¨å¢å¼ºçš„ä¸Šä¸‹æ–‡ç”Ÿæˆ
    response = llm.generate(
        system_prompt=get_expert_system_prompt(user_context["domain"]),
        context=context,
        query=user_query
    )
    
    # æ­¥éª¤4: è´¨é‡éªŒè¯
    if quality_check(response) < 4.0:
        # å‡çº§åˆ°æ•™å¸ˆæ¨¡å‹
        response = teacher_model.generate(
            system_prompt=get_expert_system_prompt(user_context["domain"]),
            context=context,
            query=user_query
        )
    
    return response
```

**å…³é”®å¢å¼º**ï¼š
1. **åŠ¨æ€æ£€ç´¢**: åŸºäºæŸ¥è¯¢ç›¸å…³æ€§æ£€ç´¢ç¤ºä¾‹
2. **é¢†åŸŸè¿‡æ»¤**: åªç”¨é¢†åŸŸç‰¹å®šã€é«˜è´¨é‡ç¤ºä¾‹
3. **ä¸Šä¸‹æ–‡ä¸°å¯Œ**: æŒ‡å— + åå¥½ + ç¤ºä¾‹
4. **è´¨é‡æ§åˆ¶**: è´¨é‡ä¸‹é™æ—¶è‡ªåŠ¨å‡çº§

---

## 3. æ¡ˆä¾‹æ¨ç†é›†æˆ

### 3.1 CBRç†è®º [3]

**CBRçš„å››ä¸ªR**ï¼š
```
1. Retrieveï¼ˆæ£€ç´¢ï¼‰: æ‰¾åˆ°ç›¸ä¼¼çš„è¿‡å¾€æ¡ˆä¾‹
2. Reuseï¼ˆå¤ç”¨ï¼‰: é€‚é…è¿‡å¾€è§£å†³æ–¹æ¡ˆ
3. Reviseï¼ˆä¿®è®¢ï¼‰: è°ƒæ•´ä»¥é€‚åº”å½“å‰ä¸Šä¸‹æ–‡
4. Retainï¼ˆä¿ç•™ï¼‰: å­˜å‚¨æ–°æ¡ˆä¾‹ä¾›æœªæ¥ä½¿ç”¨
```

### 3.2 ç‰çå¥èº«ä¸­çš„CBR

```python
class CaseBasedReasoning:
    def __init__(self, knowledge_graph, vector_db):
        self.kg = knowledge_graph
        self.vdb = vector_db
        self.case_library = CaseLibrary()
    
    def solve(self, problem: Dict) -> Dict:
        # 1. RETRIEVEï¼ˆæ£€ç´¢ï¼‰: æ‰¾ç›¸ä¼¼æ¡ˆä¾‹
        similar_cases = self.retrieve_similar_cases(
            problem_vector=self.vdb.embed(problem["description"]),
            constraints=problem["constraints"],
            top_k=5
        )
        
        # 2. REUSEï¼ˆå¤ç”¨ï¼‰: é€‚é…æœ€ä½³æ¡ˆä¾‹
        best_case = self.rank_cases(similar_cases, problem)[0]
        adapted_solution = self.adapt_solution(
            past_solution=best_case["solution"],
            current_context=problem["context"]
        )
        
        # 3. REVISEï¼ˆä¿®è®¢ï¼‰: é€šè¿‡å›¾æ¨ç†éªŒè¯
        if not self.verify_solution(adapted_solution, problem):
            adapted_solution = self.revise_solution(
                solution=adapted_solution,
                violations=self.get_violations(adapted_solution, problem)
            )
        
        # 4. RETAINï¼ˆä¿ç•™ï¼‰: è´¨é‡é«˜åˆ™å­˜å‚¨
        if problem.get("feedback", {}).get("rating", 0) >= 4:
            self.case_library.add_case({
                "problem": problem,
                "solution": adapted_solution,
                "feedback": problem["feedback"],
                "timestamp": datetime.now()
            })
        
        return adapted_solution
    
    def retrieve_similar_cases(self, problem_vector, constraints, top_k):
        """æ··åˆæ£€ç´¢: å‘é‡ + å›¾"""
        # å‘é‡: è¯­ä¹‰ç›¸ä¼¼åº¦
        vector_candidates = self.vdb.search(
            vector=problem_vector,
            limit=top_k * 5  # å¬å›é˜¶æ®µ
        )
        
        # å›¾: çº¦æŸè¿‡æ»¤
        filtered_cases = []
        for case in vector_candidates:
            if self.check_constraints(case, constraints):
                filtered_cases.append(case)
        
        return filtered_cases[:top_k]
    
    def adapt_solution(self, past_solution, current_context):
        """é€‚é…è¿‡å¾€è§£å†³æ–¹æ¡ˆåˆ°å½“å‰ä¸Šä¸‹æ–‡"""
        # ä½¿ç”¨LLMè¿›è¡Œé€‚é…
        prompt = f"""
        è¿‡å¾€æ¡ˆä¾‹è§£å†³æ–¹æ¡ˆ:
        {past_solution}
        
        å½“å‰ä¸Šä¸‹æ–‡å·®å¼‚:
        {self.diff_contexts(past_solution["context"], current_context)}
        
        ä¸ºå½“å‰ä¸Šä¸‹æ–‡é€‚é…è§£å†³æ–¹æ¡ˆ:
        """
        
        return llm.generate(prompt)
```

**ç¤ºä¾‹**ï¼š
```
é—®é¢˜: "è†ç›–æœ¯åACLåº·å¤è®­ç»ƒ"

1. RETRIEVEï¼ˆæ£€ç´¢ï¼‰:
   â†’ æ‰¾åˆ°æ¡ˆä¾‹: "è†ç›–åº·å¤", "ACLæ¢å¤", "æœ¯åè®­ç»ƒ"
   â†’ è¿‡æ»¤æ¡ä»¶: surgery_type=ACL, phase=early_rehab
   
2. REUSEï¼ˆå¤ç”¨ï¼‰:
   è¿‡å¾€æ¡ˆä¾‹: "ACLåº·å¤ç¬¬2-4å‘¨"
   è§£å†³æ–¹æ¡ˆ: [è‚¡å››å¤´è‚Œé™æ€æ”¶ç¼©, è¸æ³µ, ç›´è…¿æŠ¬é«˜]
   
3. REVISEï¼ˆä¿®è®¢ï¼‰:
   å½“å‰ä¸Šä¸‹æ–‡: "æ‚£è€…åœ¨20Â°å±ˆæ›²æ—¶ç–¼ç—›"
   é€‚é…: å‡å°‘ROMè®­ç»ƒ, å¢åŠ ç–¼ç—›ç®¡ç†
   
4. RETAINï¼ˆä¿ç•™ï¼‰:
   å¦‚æœæ‚£è€…åé¦ˆ â‰¥ 4/5 â†’ ä¿å­˜åˆ°æ¡ˆä¾‹åº“
```

---

## 4. æ•™å¸ˆ-å­¦ç”ŸååŒ

### 4.1 åŒæ¨¡å‹æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æŸ¥è¯¢è·¯ç”±å™¨                          â”‚
â”‚    ï¼ˆå¤æ‚åº¦åˆ†ç±»ï¼‰                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                 â”‚
        ç®€å• â”‚                 â”‚ å¤æ‚
             â†“                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å­¦ç”Ÿæ¨¡å‹          â”‚  â”‚   æ•™å¸ˆæ¨¡å‹           â”‚
â”‚  (Ollama 8B)       â”‚  â”‚   (DeepSeek 67B)     â”‚
â”‚  - å¿«é€Ÿ            â”‚  â”‚   - é«˜è´¨é‡           â”‚
â”‚  - å…è´¹            â”‚  â”‚   - æ¨ç†èƒ½åŠ›å¼º       â”‚
â”‚  - 90%æŸ¥è¯¢         â”‚  â”‚   - 10%æŸ¥è¯¢          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                 â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  è´¨é‡ç›‘æ§å™¨      â”‚
            â”‚  - æ£€æŸ¥è¾“å‡º      â”‚
            â”‚  - è´¨é‡<4.0æ—¶    â”‚
            â”‚    å‡çº§          â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 è·¯ç”±é€»è¾‘

```python
class QueryRouter:
    def __init__(self, student_model, teacher_model):
        self.student = student_model
        self.teacher = teacher_model
        self.complexity_threshold = 0.7
    
    def route(self, query: str, context: Dict) -> str:
        # åˆ†ç±»å¤æ‚åº¦
        complexity = self.classify_complexity(query, context)
        
        if complexity < self.complexity_threshold:
            # ç®€å•æŸ¥è¯¢ â†’ å­¦ç”Ÿæ¨¡å‹
            response = self.student.generate(
                query=query,
                context=context
            )
            
            # è´¨é‡æ£€æŸ¥
            if self.check_quality(response) >= 4.0:
                return response
            else:
                # è´¨é‡ä¸è¶³ â†’ å‡çº§åˆ°æ•™å¸ˆ
                return self.teacher.generate(query=query, context=context)
        else:
            # å¤æ‚æŸ¥è¯¢ â†’ ç›´æ¥ç”¨æ•™å¸ˆæ¨¡å‹
            return self.teacher.generate(query=query, context=context)
    
    def classify_complexity(self, query: str, context: Dict) -> float:
        """
        åˆ†ç±»æŸ¥è¯¢å¤æ‚åº¦
        
        å› ç´ :
            - éœ€è¦å¤šè·³æ¨ç†å—?
            - å¤šä¸ªçº¦æŸæ¡ä»¶?
            - å†²çªçš„éœ€æ±‚?
            - å®‰å…¨å…³é”®?
        """
        features = {
            "multi_hop": self.detect_multi_hop(query),
            "constraints_count": self.count_constraints(query),
            "conflicts": self.detect_conflicts(query, context),
            "safety_critical": self.is_safety_critical(query, context)
        }
        
        # åŠ æƒå¤æ‚åº¦åˆ†æ•°
        complexity = (
            0.3 * features["multi_hop"] +
            0.2 * min(features["constraints_count"] / 5, 1.0) +
            0.3 * features["conflicts"] +
            0.2 * features["safety_critical"]
        )
        
        return complexity
```

### 4.3 çŸ¥è¯†è’¸é¦ï¼ˆéšå¼ï¼‰

**ä¸æ˜¯ä¼ ç»Ÿè’¸é¦** [4]ï¼š
```
ä¼ ç»ŸçŸ¥è¯†è’¸é¦:
    - è®­ç»ƒå­¦ç”Ÿæ¨¡ä»¿æ•™å¸ˆè¾“å‡º
    - éœ€è¦è®­ç»ƒæ•°æ®å’Œå¾®è°ƒ
    - æ›´æ–°å­¦ç”Ÿæ¨¡å‹æƒé‡
    
æˆ‘ä»¬çš„æ–¹æ³•ï¼ˆéšå¼è’¸é¦ï¼‰:
    - æ— éœ€è®­ç»ƒ
    - å­¦ç”Ÿä»æ•™å¸ˆç¤ºä¾‹ä¸­é€šè¿‡ä¸Šä¸‹æ–‡å­¦ä¹ 
    - æ•™å¸ˆçš„å›ç­”æˆä¸ºå­¦ç”Ÿçš„Few-Shotç¤ºä¾‹
    - ä¸æ›´æ–°æƒé‡
```

**ç¤ºä¾‹**ï¼š
```python
# æ•™å¸ˆå¤„ç†å¤æ‚æŸ¥è¯¢
teacher_response = teacher_model.generate(
    query="è®¾è®¡ä¸€ä¸ªåŠ›é‡ä¸¾æ¯”èµ›çš„å‘¨æœŸåŒ–è®­ç»ƒè®¡åˆ’"
)

# å­˜å‚¨ä¸ºé«˜è´¨é‡ç¤ºä¾‹
case_library.add_case({
    "query": query,
    "response": teacher_response,
    "quality_score": 5.0,
    "complexity": "high"
})

# ç¨å,å­¦ç”Ÿæ£€ç´¢è¿™ä¸ªä½œä¸ºç¤ºä¾‹
student_context = retrieve_examples(
    query="åˆ›å»ºä¸€ä¸ªåŠ›é‡è®­ç»ƒè®¡åˆ’",
    include_teacher_examples=True  # ä½¿ç”¨æ•™å¸ˆçš„è¿‡å¾€å›ç­”
)

student_response = student_model.generate(
    context=student_context,  # åŒ…å«æ•™å¸ˆçš„ç¤ºä¾‹
    query="åˆ›å»ºä¸€ä¸ªåŠ›é‡è®­ç»ƒè®¡åˆ’"
)
```

---

## 5. è´¨é‡ç›‘æ§

### 5.1 è´¨é‡æŒ‡æ ‡

```python
class QualityMonitor:
    def assess_quality(self, response: Dict, ground_truth: Dict = None) -> float:
        """
        å¤šç»´è´¨é‡è¯„ä¼°
        
        è¿”å›: è´¨é‡åˆ†æ•° 0-5
        """
        scores = []
        
        # 1. å®Œæ•´æ€§: æ˜¯å¦å›ç­”äº†æ‰€æœ‰æ–¹é¢ï¼Ÿ
        completeness = self.check_completeness(
            response=response,
            query_aspects=ground_truth.get("aspects", [])
        )
        scores.append(completeness)
        
        # 2. å‡†ç¡®æ€§: äº‹å®æ˜¯å¦æ­£ç¡®ï¼Ÿ
        accuracy = self.check_accuracy(
            response=response,
            knowledge_graph=self.kg
        )
        scores.append(accuracy)
        
        # 3. å®‰å…¨æ€§: å»ºè®®æ˜¯å¦å®‰å…¨ï¼Ÿ
        safety = self.check_safety(
            response=response,
            safety_rules=self.safety_rules
        )
        scores.append(safety)
        
        # 4. ç›¸å…³æ€§: æ˜¯å¦åˆ‡é¢˜ï¼Ÿ
        relevance = self.check_relevance(
            response=response,
            query=ground_truth.get("query", "")
        )
        scores.append(relevance)
        
        # 5. è¿è´¯æ€§: ç»“æ„æ˜¯å¦è‰¯å¥½ï¼Ÿ
        coherence = self.check_coherence(response)
        scores.append(coherence)
        
        # åŠ æƒå¹³å‡
        weights = [0.25, 0.30, 0.25, 0.10, 0.10]
        quality_score = sum(s * w for s, w in zip(scores, weights))
        
        return quality_score
    
    def check_accuracy(self, response: Dict, knowledge_graph):
        """å¯¹ç…§çŸ¥è¯†å›¾è°±éªŒè¯äº‹å®"""
        claims = self.extract_claims(response)
        verified_count = 0
        
        for claim in claims:
            # æŸ¥è¯¢å›¾è°±è¿›è¡ŒéªŒè¯
            cypher = f"""
            MATCH (e:Entity {{name: "{claim.subject}"}})
            -[r:{claim.relation}]->
            (o:Entity {{name: "{claim.object}"}})
            RETURN count(r) > 0 as verified
            """
            
            if knowledge_graph.execute(cypher)[0]["verified"]:
                verified_count += 1
        
        accuracy = verified_count / len(claims) if claims else 0.0
        return accuracy * 5.0  # ç¼©æ”¾åˆ°0-5
```

### 5.2 è‡ªåŠ¨å‡çº§

```python
def generate_with_quality_control(query: str, context: Dict) -> Dict:
    """å¸¦è´¨é‡æ§åˆ¶çš„ç”Ÿæˆå“åº”"""
    
    # å…ˆå°è¯•å­¦ç”Ÿ
    response = student_model.generate(query, context)
    quality = quality_monitor.assess_quality(response)
    
    if quality >= 4.0:
        return {
            "response": response,
            "model": "student",
            "quality": quality,
            "cost": 0.0
        }
    else:
        # è´¨é‡ä¸è¶³ â†’ å‡çº§åˆ°æ•™å¸ˆ
        teacher_response = teacher_model.generate(query, context)
        teacher_quality = quality_monitor.assess_quality(teacher_response)
        
        return {
            "response": teacher_response,
            "model": "teacher",
            "quality": teacher_quality,
            "cost": calculate_cost(teacher_response),
            "escalation_reason": f"å­¦ç”Ÿè´¨é‡ {quality:.1f} < 4.0"
        }
```

---

## 6. æ€§èƒ½åˆ†æ

### 6.1 æˆæœ¬ä¼˜åŒ–

**åŸºå‡†ï¼ˆä»…GPT-4ï¼‰**ï¼š
```
æŸ¥è¯¢é‡/å¤©: 1000
æˆæœ¬/æŸ¥è¯¢: $0.045 (1500 tokens @ $0.03/1K)
æ¯æ—¥æˆæœ¬: $45
æœˆæˆæœ¬: $1350
```

**ç‰çå¥èº«ï¼ˆå­¦ç”Ÿ+æ•™å¸ˆï¼‰**ï¼š
```
å­¦ç”Ÿï¼ˆ90%æŸ¥è¯¢ï¼‰:
    - æ¨¡å‹: Ollama 8Bï¼ˆæœ¬åœ°,å…è´¹ï¼‰
    - æŸ¥è¯¢: 900/å¤©
    - æˆæœ¬: $0
    
æ•™å¸ˆï¼ˆ10%æŸ¥è¯¢ï¼‰:
    - æ¨¡å‹: DeepSeek 67B
    - æŸ¥è¯¢: 100/å¤©
    - æˆæœ¬/æŸ¥è¯¢: $0.001 (200 tokens @ $0.005/1K)
    - æ¯æ—¥æˆæœ¬: $0.10
    - æœˆæˆæœ¬: $3

æ€»æœˆæˆæœ¬: $3 vs $1350 â†’ å‡å°‘99.8%
```

### 6.2 è´¨é‡å¯¹æ¯”

| æ¨¡å‹ | å¹³å‡è´¨é‡ | å¤æ‚æŸ¥è¯¢è´¨é‡ | ç®€å•æŸ¥è¯¢è´¨é‡ |
|-------|---------|------------|-----------|
| ä»…GPT-4 | 4.3/5 | 4.5/5 | 4.2/5 |
| ä»…å­¦ç”Ÿ | 3.8/5 | 2.9/5 | 4.1/5 |
| **ç‰çå¥èº«** | **4.4/5** | **4.6/5** | **4.2/5** |

**åˆ†æ**ï¼š
- å­¦ç”Ÿå¤„ç†ç®€å•æŸ¥è¯¢æ•ˆæœå¥½ï¼ˆ4.1/5ï¼‰
- æ•™å¸ˆç¡®ä¿å¤æ‚æŸ¥è¯¢è´¨é‡ï¼ˆ4.6/5ï¼‰
- æ•´ä½“è´¨é‡ä¸GPT-4ç›¸å½“æˆ–æ›´å¥½
- æˆæœ¬é™ä½99.8%,è´¨é‡ç›¸å½“æˆ–æ›´å¥½

---

## 7. å±€é™æ€§å’Œæœªæ¥å·¥ä½œ

### 7.1 å½“å‰å±€é™

1. **ä¸æ˜¯çœŸæ­£çš„å­¦ä¹ **
   - æ²¡æœ‰æƒé‡æ›´æ–°
   - æ— æ³•å‘ç°è®­ç»ƒæ•°æ®ä¹‹å¤–çš„æ–°æ¨¡å¼
   - å—é™äºé¢„è®­ç»ƒçŸ¥è¯†

2. **ä¸Šä¸‹æ–‡çª—å£é™åˆ¶**
   - ä¸Šä¸‹æ–‡ä¸­ç¤ºä¾‹æ•°é‡æœ‰é™
   - é•¿ä¸Šä¸‹æ–‡ â†’ æ¨ç†æ›´æ…¢
   - æŸäº›æ¨¡å‹æœ‰ç¡¬é™åˆ¶ï¼ˆå¦‚4K, 8K tokensï¼‰

3. **è´¨é‡æ³¢åŠ¨**
   - ICLæ€§èƒ½å› æ¨¡å‹è€Œå¼‚
   - å°æ¨¡å‹å¯é æ€§è¾ƒä½
   - éœ€è¦è´¨é‡ç›‘æ§å¼€é”€

### 7.2 æœªæ¥å¢å¼ºï¼ˆv2.1+ï¼‰

1. **æŒç»­å­¦ä¹ **ï¼ˆv2.1ï¼‰
   - å®šæœŸåœ¨ç§¯ç´¯çš„æ¡ˆä¾‹ä¸Šå¾®è°ƒå­¦ç”Ÿ
   - çœŸæ­£ä»æ•™å¸ˆæ¼”ç¤ºä¸­å­¦ä¹ 
   - é€æ­¥å‡å°‘å¯¹æ•™å¸ˆçš„ä¾èµ–

2. **å¤šæ¨¡æ€ICL**ï¼ˆv2.2ï¼‰
   - å›¾ç‰‡ä½œä¸ºç¤ºä¾‹ï¼ˆåŠ¨ä½œç¤ºèŒƒè§†é¢‘ï¼‰
   - éŸ³é¢‘æŒ‡å¯¼
   - è·¨æ¨¡æ€æ¨ç†

3. **ä¸»åŠ¨å­¦ä¹ **ï¼ˆv3.0ï¼‰
   - è¯†åˆ«çŸ¥è¯†ç¼ºå£
   - è¯·æ±‚é’ˆå¯¹æ€§çš„æ•™å¸ˆæ¼”ç¤º
   - ä¼˜åŒ–æ¡ˆä¾‹åº“

---

## 8. å­¦æœ¯å‚è€ƒ

[1] Hospedales, T., et al. (2021). "Meta-Learning in Neural Networks: A Survey." *IEEE Transactions on Pattern Analysis and Machine Intelligence*, 44(9), 5149-5169.

[2] Brown, T., et al. (2020). "Language Models are Few-Shot Learners." *NeurIPS 2020*.

[3] Aamodt, A., & Plaza, E. (1994). "Case-Based Reasoning: Foundational Issues, Methodological Variations, and System Approaches." *AI Communications*, 7(1), 39-59.

[4] Hinton, G., Vinyals, O., & Dean, J. (2015). "Distilling the Knowledge in a Neural Network." *arXiv:1503.02531*.

[5] Dong, Q., et al. (2023). "A Survey on In-Context Learning." *arXiv:2301.00234*.

---

## 9. ç»“è®º

ç‰çå¥èº«çš„"æ¨ç†æ—¶ä¸Šä¸‹æ–‡å­¦ä¹ "æ–¹æ³•ï¼ˆä¹‹å‰é”™è¯¯åœ°å‘½åä¸º"æ¨ç†æ—¶å…ƒå­¦ä¹ "ï¼‰ä¸æ˜¯æ–°çš„ç†è®ºè´¡çŒ®,è€Œæ˜¯ä¸€ç§å·¥ç¨‹æœ€ä½³å®è·µ,å®ƒï¼š

1. **æ­£ç¡®åº”ç”¨ICL**: åˆ©ç”¨LLMå›ºæœ‰çš„Few-Shotèƒ½åŠ›
2. **ç”¨GraphRAGå¢å¼º**: é¢†åŸŸç‰¹å®šã€é«˜è´¨é‡ç¤ºä¾‹
3. **æ·»åŠ æ¡ˆä¾‹æ¨ç†**: ç»“æ„åŒ–æ¡ˆä¾‹æ£€ç´¢å’Œé€‚é…
4. **ä¼˜åŒ–æˆæœ¬**: æ•™å¸ˆ-å­¦ç”ŸååŒï¼ˆé™ä½99.8%æˆæœ¬ï¼‰
5. **ä¿æŒè´¨é‡**: è‡ªåŠ¨è´¨é‡ç›‘æ§å’Œå‡çº§

**å…³é”®è¦ç‚¹**: æˆ‘ä»¬ä¸å£°ç§°å‘æ˜äº†æ–°çš„å­¦ä¹ èŒƒå¼ã€‚æˆ‘ä»¬è®¾è®¡äº†ä¸€ä¸ªå®ç”¨ç³»ç»Ÿ,å°†ç»è¿‡éªŒè¯çš„æŠ€æœ¯ï¼ˆICLã€CBRã€GraphRAGã€åŒæ¨¡å‹ï¼‰ç»“åˆèµ·æ¥,ç”¨äºç”Ÿäº§å°±ç»ªã€æˆæœ¬æœ‰æ•ˆçš„å‚ç›´é¢†åŸŸAIã€‚

---

**ç»´æŠ¤è€…**: ç‰çå¥èº« æ¡†æ¶ Team  
**æœ€åæ›´æ–°**: 2025-11-05  
**ç‰ˆæœ¬**: 1.0.0  
**çŠ¶æ€**: ğŸ“ æ ¸å¿ƒç†è®ºå®Œæ•´

**ä¸‹ä¸€æ­¥**: é˜…è¯» [03-å¤šæ™ºèƒ½ä½“ååŒç†è®º.md](./03-å¤šæ™ºèƒ½ä½“ååŒç†è®º.md) äº†è§£æ™ºèƒ½ä½“ååŒç†è®ºã€‚

